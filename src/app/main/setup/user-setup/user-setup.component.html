<p-toast></p-toast>
<p-confirmDialog></p-confirmDialog>
<div class="card" id="formFields" tabindex="1">
  <p-tabView orientation="left">
    <p-tabPanel header="Setup User" leftIcon="pi pi-home">
      <div class="p-grid card" style="width: 100%">
        <div class="p-col-12" style="width: 100%">
          <div class="card mb-4">
            <div class="p-card-body mt-4" #formWrapper id="formWrapper">
              <div class="row card widget-timeline border p-4 mb-5">
                <div class="col-7" style="width: 100%">
                  <form [formGroup]="userForm" (ngSubmit)="CreateUser()">
                    <div class="p-fluid p-formgrid p-grid">
                      <div class="p-field p-col-12 p-md-3" style="width: 50%">
                        <label for="lnameCapt">Last Name</label>
                        <input
                          id="lnameCapt"
                          type="text"
                          placeholder="LastName"
                          formControlName="LastName"
                          pInputText
                        />
                      </div>
                      <div class="p-field p-col-12 p-md-3" style="width: 50%">
                        <label for="fnameLabel">First Name</label>
                        <input
                          id="fnameLabel"
                          type="text"
                          placeholder="FirstName"
                          formControlName="FirstName"
                          pInputText
                        />
                      </div>
                    </div>
                    <div class="p-fluid p-formgrid p-grid">
                      <div class="p-field p-col-12 p-md-3" style="width: 50%">
                        <label for="onameCapt">Other Name</label>
                        <input
                          id="onameCapt"
                          type="text"
                          placeholder="OtherName"
                          formControlName="OtherName"
                          pInputText
                        />
                      </div>
                      <div class="p-field p-col-12 p-md-3" style="width: 50%">
                        <label for="cnameLabel">Code Name</label>
                        <input
                          id="cnameLabel"
                          type="text"
                          placeholder="CodeName"
                          formControlName="CodeName"
                          pInputText
                        />
                      </div>
                    </div>
                    <div class="p-fluid p-formgrid p-grid">
                      <div class="p-field p-col-12 p-md-3" style="width: 50%">
                        <label for="mobileLabel">Phone Number</label>
                        <input
                          id="mobileLabel"
                          type="text"
                          placeholder="Mobile"
                          formControlName="Mobile"
                          pInputText
                        />
                      </div>
                      <div class="p-field p-col-12 p-md-3" style="width: 50%">
                        <label for="emailLabel">Email</label>
                        <input
                          id="emailLabel"
                          type="text"
                          placeholder="Email"
                          formControlName="Email"
                          pInputText
                        />
                      </div>
                    </div>
                    <div class="p-fluid p-formgrid p-grid">
                      <div class="p-field p-col-12 p-md-3" style="width: 50%">
                        <label for="pswLabel">Default Password</label>
                        <input
                          id="pswLabel"
                          type="password"
                          placeholder="Default Password"
                          formControlName="DefaultPassword"
                          pInputText
                        />
                      </div>
                      <div class="p-field p-col-12 p-md-3" style="width: 50%">
                        <label for="roleLabel">Assigned Role</label>
                        <p-dropdown
                          inputId="roleLabel"
                          [options]="allRoles"
                          [(ngModel)]="theRole"
                          placeholder="--Select--"
                          [showClear]="true"
                          [filter]="true"
                          optionLabel="name"
                          formControlName="AssignedRole"
                        ></p-dropdown>
                      </div>
                    </div>
                    <div class="p-fluid p-formgrid p-grid">
                      <div class="p-field p-col-12 p-md-3" style="width: 50%">
                        <label for="adressLabel">Address</label>
                        <textarea
                          type="text"
                          rows="4"
                          cols="14"
                          pInputTextarea
                          id="adressLabel"
                          placeholder="Address"
                          formControlName="Address"
                        ></textarea>
                      </div>
                      <div
                        class="p-field p-col-12 p-md-3"
                        style="width: 50%"
                      ></div>
                    </div>
                    <div class="p-grid">
                      <div class="p-col-12 p-md-12">
                        <div class="pt-2 text-right">
                          <button
                            style="width: 20%"
                            pButton
                            pRipple
                            type="submit"
                            *ngIf="!editingUser"
                            [disabled]="userForm.invalid"
                            label="Create User Account"
                            icon="pi pi-plus-circle"
                            class="p-button-raised p-mr-2 p-mb-2"
                          ></button>
                          <button
                            pButton
                            pRipple
                            type="submit"
                            *ngIf="editingUser"
                            (click)="CloseEditing()"
                            label="Cancel Editing"
                            icon="pi pi-times-circle"
                            class="p-button-raised p-mr-2 p-mb-2 p-button-danger"
                          ></button>
                          <button
                            pButton
                            pRipple
                            type="button"
                            *ngIf="editingUser"
                            [disabled]="userForm.invalid"
                            (click)="UpdateUser()"
                            icon="pi pi-save"
                            label="Update User Account"
                            class="p-button-raised p-mr-0 p-mb-2"
                          ></button>
                        </div>
                      </div>
                    </div>
                  </form>
                </div>
              </div>
              <div class="row">
                <div class="col-12">
                  <div class="card">
                    <div
                      *ngIf="fetchingUsers; else tableData"
                      class="text-center"
                    >
                      <p-progressSpinner></p-progressSpinner>
                    </div>
                    <ng-template #tableData>
                      <div class="row" style="width: 100%">
                        <div class="p-fluid">
                          <p-messages [value]="summaryMsg"></p-messages>
                        </div>
                      </div>
                      <div class="row" style="width: 100%">
                        <div class="p-grid p-fluid">
                          <div class="p-col-12">
                            <p-dataView
                              #dv
                              [value]="allUsers"
                              [paginator]="true"
                              filterBy="name"
                              [rows]="6"
                              [sortField]="sortField"
                              [sortOrder]="sortOrder"
                              layout="grid"
                            >
                              <ng-template pTemplate="header">
                                <div
                                  class="p-d-flex p-flex-column p-flex-md-row p-jc-md-between"
                                >
                                  <span
                                    class="p-input-icon-left p-mb-2 p-mb-md-0"
                                    style="margin-right: 20px"
                                  >
                                    <i class="pi pi-search"></i>
                                    <input
                                      type="search"
                                      pInputText
                                      placeholder="Search by Last Name"
                                      (input)="dv.filter($event.target.value)"
                                    />
                                  </span>
                                  <p-dataViewLayoutOptions></p-dataViewLayoutOptions>
                                </div>
                              </ng-template>
                              <ng-template let-user pTemplate="listItem">
                                <div class="p-col-12">
                                  <div
                                    class="product-list-item card widget-timeline border p-4 mb-5 shadow rounded"
                                    style="
                                      margin-top: 20px;
                                      margin-bottom: 20px;
                                    "
                                  >
                                    <h5
                                      style="
                                        align-items: center;
                                        text-align: center;
                                      "
                                    >
                                      {{ user.lastName + ' ' user.firstName }}
                                    </h5>
                                    <img
                                      style="width: 120px; height: 120px"
                                      [src]="
                                        user.profilePic
                                          ? user.profilePic
                                          : 'assets/no-profile.png'
                                      "
                                      [alt]="user.lastName"
                                    />
                                    <div class="product-list-detail">
                                      <div class="product-name">
                                        {{
                                          "Created On: " +
                                            (user.dateRegistered
                                              | date: "yyyy-MM-dd")
                                        }}
                                      </div>
                                      <div class="product-description">
                                        {{
                                          "Created By: " +
                                            GetUserFullName(user.registredById)
                                        }}
                                      </div>
                                      <br />
                                      <i
                                        class="pi pi-discord product-category-icon"
                                      ></i
                                      ><span class="product-category"></span>
                                    </div>
                                    <div class="product-list-action">
                                      <span class="product-price"></span>
                                      <br />
                                    </div>
                                    <br />
                                  </div>
                                  <p-button
                                    *ngIf="user.isDeactivated"
                                    icon=""
                                    label="Activate"
                                    styleClass="p-mr-2 p-button-success"
                                    (click)="SwitchUserStatus(user)"
                                  ></p-button>
                                  <p-button
                                    *ngIf="!user.isDeactivated"
                                    icon=""
                                    label="Deactivate"
                                    styleClass="p-mr-2 p-button-danger"
                                    (click)="SwitchUserStatus(user)"
                                  ></p-button>
                                  <div
                                    style="
                                      width: 100%;
                                      align-items: center;
                                      text-align: center;
                                      margin-top: 2px;
                                    "
                                  >
                                    <p-button
                                      label=""
                                      icon="pi pi-pencil"
                                      styleClass="p-mr-2 p-button-info"
                                      (onClick)="EditUser(user)"
                                    ></p-button>
                                    <p-button
                                      label=""
                                      icon="pi pi-trash"
                                      styleClass="p-mr-2 p-button-primary"
                                      (onClick)="DeleteUser(user)"
                                    ></p-button>
                                  </div>
                                </div>
                              </ng-template>
                            </p-dataView>
                          </div>
                        </div>
                      </div>
                    </ng-template>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </p-tabPanel>
    <p-tabPanel
      header="Review User Creation"
      leftIcon="pi pi-home"
    ></p-tabPanel>
  </p-tabView>
</div>
